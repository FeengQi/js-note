本章内容
 - 进行离线检测
 - 使用离线缓存
 - 在浏览器中保存数据

### 23.1  离线检测
HTML5定义了一个navigator.onLine属性，为true时表示设备能上网，为false时表示设备离线。实际应用中，navigator.onLine在不同浏览器间还有差异。
  > - IE6+和Safari5+能够正确检测到网络已断开，并将navigator.onLine的值转换为false。
  > - Firefox3+Opear10.6支持navigator.onLine属性，但必须手工在菜单项‘文件-Web开发人员（设置）-脱机工作’才能让浏览器正常工作。
  > - Chrome11及之前的版本始终将navigator.onLine属性设置为true（2011年10月已被修复）。
```
if(navigator.onLine){
	// 正常工作
} else {
	// 执行离线状态时的任务
}
```
HTML5定义了两个事件：
 - online
 - offline
 
当网络从离线变为在线或者从在线变为离线的时候时，分别触发这两个事件
```
EventUtil.addHandler(window,'online',function(){
	alert('OnLine')
});
EventUtil.addHandler(window,'offline',function(){
	alert('Offline')
});
```
- 为了检测是否离线，在页面加载后，最好先通过navigator.onLine取得初始状态。然后，通过上述两个事件来确定网络连接状态是否变化。当上述事件触发时，navigator.onLine属性的值也会改变，不过必须手工轮询这个属性才能检测到网络状态的变化。
- 支持离线检测的浏览器只有IE6+（只支持navigator.onLine属性）、Firefox3、Safari4、Opera10.6、Chrome、iOS3.2版Safari和Android版WebKit。

### 23.2  应用缓存
HTML5 的应用缓存（application cache），或者简称为 appcache，是专门为开发离线 Web 应用而设计的。Appcache 就是从浏览器的缓存中分出来的一块缓存区。要想在这个缓存中保存数据，可以使用一个描述文件（manifest file），列出要下载和缓存的资源。
```
CACHE MANIFEST
#Comment

file.js
file.css
```

### 23.3  数据存储
#### 23.3.1 Cookie

HTTP Cookie，通常直接叫做 cookie，最初是在客户端用于存储会话信息的。该标准要求服务器对任意 HTTP 请求发送 Set-Cookie HTTP 头作为响应的一部分，其中包含会话信息。例如，这种服务器响
应的头可能如下：

	HTTP/1.1 200 OK
	Content-type: text/html
	Set-Cookie: name=value
	Other-header: other-header-value
	
这个 HTTP 响应设置以 name 为名称、以 value 为值的一个 cookie，名称和值在传送时都必须是
URL 编码的。浏览器会存储这样的会话信息，并在这之后，通过为每个请求添加 Cookie HTTP 头将信
息发送回服务器，如下所示：

	GET /index.html HTTP/1.1
	Cookie: name=value
	Other-header: other-header-value
	
发送回服务器的额外信息可以用于唯一验证客户来自于发送的哪个请求。

- 1、限制

> 访问限制
> 
> cookie 在性质上是绑定在特定的域名下的。当设定了一个 cookie 后，再给创建它的域名发送请求时，都会包含这个 cookie。这个限制确保了储存在 cookie 中的信息只能让批准的接受者访问，而无法被其他域访问。

> 大小限制
> 
> - IE6 以及更低版本限制每个域名最多 20 个 cookie。
> - IE7 和之后版本每个域名最多 50 个。IE7 最初是支持每个域名最大 20 个 cookie，之后被微软的一个补丁所更新。
> - Firefox 限制每个域最多 50 个 cookie。
> - Opera 限制每个域最多 30 个 cookie。
> - Safari 和 Chrome 对于每个域的 cookie 数量限制没有硬性规定。

> 浏览器中对于 cookie 的尺寸也有限制。大多数浏览器都有大约 4096B（加减 1）的长度限制。为了最佳的浏览器兼容性，最好将整个 cookie 长度限制在4095B（含 4095）以内。尺寸限制影响到一个域下所有的 cookie，而并非每个 cookie 单独限制。

- 2、cookie 的构成

  - 名称：一个唯一确定 cookie 的名称。cookie 名称是不区分大小写的，所以 myCookie 和 MyCookie被认为是同一个 cookie。然而，实践中最好将 cookie 名称看作是区分大小写的，因为某些服务器会这样处理 cookie。cookie 的名称必须是经过 URL 编码的。 
  - 值：储存在 cookie 中的字符串值。值必须被 URL 编码。
  - 域：cookie 对于哪个域是有效的。所有向该域发送的请求中都会包含这个 cookie 信息。这个值可以包含子域（subdomain，如www.wrox.com），也可以不包含它（如.wrox.com，则对于wrox.com的所有子域都有效）。如果没有明确设定，那么这个域会被认作来自设置 cookie 的那个域。
  - 路径：对于指定域中的那个路径，应该向服务器发送 cookie。例如，你可以指定 cookie 只有从http://www.wrox.com/books/ 中才能访问，那么http://www.wrox.com 的页面就不会发送 cookie 信息，即使请求都是来自同一个域的。
  - 失效时间：表示 cookie 何时应该被删除的时间戳（也就是，何时应该停止向服务器发送这个cookie）。默认情况下，浏览器会话结束时即将所有 cookie 删除；不过也可以自己设置删除时间。这个值是个 GMT 格式的日期（Wdy, DD-Mon-YYYY HH:MM:SS GMT），用于指定应该删除cookie 的准确时间。因此，cookie 可在浏览器关闭后依然保存在用户的机器上。如果你设置的失效日期是个以前的时间，则 cookie 会被立刻删除。
  - 安全标志：指定后，cookie 只有在使用 SSL 连接的时候才发送到服务器。例如，cookie 信息只能发送给 https://www.wrox.com，而 http://www.wrox.com 的请求则不能发送 cookie。 
